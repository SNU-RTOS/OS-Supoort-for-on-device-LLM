Directory '/home/rtos/workspace/ghpark/export/llama-3.2-3b-it-fp32' already exists. Skipping creation.
2025-02-23 20:44:44.060560: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:467] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered
WARNING: All log messages before absl::InitializeLog() is called are written to STDERR
E0000 00:00:1740311084.189594   63070 cuda_dnn.cc:8593] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
E0000 00:00:1740311084.228052   63070 cuda_blas.cc:1407] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2025-02-23 20:44:44.542614: I tensorflow/core/platform/cpu_feature_guard.cc:210] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
/home/rtos/.local/lib/python3.10/site-packages/torch/distributed/distributed_c10d.py:354: UserWarning: Device capability of jax unspecified, assuming `cpu` and `cuda`. Please specify it via the `devices` argument of `register_backend`.
  warnings.warn(
WARNING:2025-02-23 20:44:52,737:jax._src.xla_bridge:987: An NVIDIA GPU may be present on this machine, but a CUDA-enabled jaxlib is not installed. Falling back to cpu.
I0223 20:44:54.635332 132171970714496 convert_to_tflite.py:77] Active absl flags:
I0223 20:44:54.635527 132171970714496 convert_to_tflite.py:79] logtostderr: False
I0223 20:44:54.635627 132171970714496 convert_to_tflite.py:79] alsologtostderr: False
I0223 20:44:54.635715 132171970714496 convert_to_tflite.py:79] log_dir: 
I0223 20:44:54.635784 132171970714496 convert_to_tflite.py:79] v: 0
I0223 20:44:54.635870 132171970714496 convert_to_tflite.py:79] verbosity: 0
I0223 20:44:54.635937 132171970714496 convert_to_tflite.py:79] logger_levels: {}
I0223 20:44:54.636002 132171970714496 convert_to_tflite.py:79] stderrthreshold: fatal
I0223 20:44:54.636045 132171970714496 convert_to_tflite.py:79] showprefixforinfo: True
I0223 20:44:54.636089 132171970714496 convert_to_tflite.py:79] run_with_pdb: False
I0223 20:44:54.636133 132171970714496 convert_to_tflite.py:79] pdb_post_mortem: False
I0223 20:44:54.636177 132171970714496 convert_to_tflite.py:79] pdb: False
I0223 20:44:54.636219 132171970714496 convert_to_tflite.py:79] run_with_profiling: False
I0223 20:44:54.636263 132171970714496 convert_to_tflite.py:79] profile_file: None
I0223 20:44:54.636306 132171970714496 convert_to_tflite.py:79] use_cprofile_for_profiling: True
I0223 20:44:54.636349 132171970714496 convert_to_tflite.py:79] only_check_args: False
I0223 20:44:54.636390 132171970714496 convert_to_tflite.py:79] op_conversion_fallback_to_while_loop: True
I0223 20:44:54.636437 132171970714496 convert_to_tflite.py:79] delta_threshold: 0.5
I0223 20:44:54.636480 132171970714496 convert_to_tflite.py:79] tt_check_filter: False
I0223 20:44:54.636522 132171970714496 convert_to_tflite.py:79] tt_single_core_summaries: False
I0223 20:44:54.636563 132171970714496 convert_to_tflite.py:79] runtime_oom_exit: True
I0223 20:44:54.636613 132171970714496 convert_to_tflite.py:79] hbm_oom_exit: True
I0223 20:44:54.636655 132171970714496 convert_to_tflite.py:79] test_srcdir: 
I0223 20:44:54.636696 132171970714496 convert_to_tflite.py:79] test_tmpdir: /tmp/absl_testing
I0223 20:44:54.636737 132171970714496 convert_to_tflite.py:79] test_random_seed: 301
I0223 20:44:54.636778 132171970714496 convert_to_tflite.py:79] test_randomize_ordering_seed: 
I0223 20:44:54.636819 132171970714496 convert_to_tflite.py:79] xml_output_file: 
I0223 20:44:54.636859 132171970714496 convert_to_tflite.py:79] model_size: 3b
I0223 20:44:54.636900 132171970714496 convert_to_tflite.py:79] checkpoint_path: /home/rtos/workspace/ghpark/models/llama-3.2-3b-it
I0223 20:44:54.636941 132171970714496 convert_to_tflite.py:79] output_path: /home/rtos/workspace/ghpark/export/llama-3.2-3b-it-fp32
I0223 20:44:54.636981 132171970714496 convert_to_tflite.py:79] output_name_prefix: llama
I0223 20:44:54.637025 132171970714496 convert_to_tflite.py:79] prefill_seq_lens: [8, 64, 128, 256, 512]
I0223 20:44:54.637068 132171970714496 convert_to_tflite.py:79] kv_cache_max_len: 1024
I0223 20:44:54.637109 132171970714496 convert_to_tflite.py:79] quantize: False
I0223 20:44:54.637151 132171970714496 convert_to_tflite.py:79] lora_ranks: None
I0223 20:44:54.637192 132171970714496 convert_to_tflite.py:79] ?: False
I0223 20:44:54.637233 132171970714496 convert_to_tflite.py:79] help: False
I0223 20:44:54.637273 132171970714496 convert_to_tflite.py:79] helpshort: False
I0223 20:44:54.637314 132171970714496 convert_to_tflite.py:79] helpfull: False
I0223 20:44:54.637354 132171970714496 convert_to_tflite.py:79] helpxml: False
W0223 20:50:21.341474 132171970714496 conversion.py:77] Your model "prefill_8" is converted in training mode. Please set the module in evaluation mode with `module.eval()` for better on-device performance and compatibility.
W0223 20:50:21.366519 132171970714496 conversion.py:77] Your model "prefill_64" is converted in training mode. Please set the module in evaluation mode with `module.eval()` for better on-device performance and compatibility.
W0223 20:50:21.366600 132171970714496 conversion.py:77] Your model "prefill_128" is converted in training mode. Please set the module in evaluation mode with `module.eval()` for better on-device performance and compatibility.
W0223 20:50:21.366668 132171970714496 conversion.py:77] Your model "prefill_256" is converted in training mode. Please set the module in evaluation mode with `module.eval()` for better on-device performance and compatibility.
W0223 20:50:21.366731 132171970714496 conversion.py:77] Your model "prefill_512" is converted in training mode. Please set the module in evaluation mode with `module.eval()` for better on-device performance and compatibility.
W0223 20:50:21.366792 132171970714496 conversion.py:77] Your model "decode" is converted in training mode. Please set the module in evaluation mode with `module.eval()` for better on-device performance and compatibility.
Fatal Python error: Segmentation fault

Current thread 0x00007835af5d1b80 (most recent call first):
  File "/home/rtos/.local/lib/python3.10/site-packages/torch/cuda/__init__.py", line 319 in _lazy_init
  File "/home/rtos/.local/lib/python3.10/site-packages/torch/cuda/random.py", line 33 in get_rng_state
  File "/home/rtos/.local/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 220 in _fn
  File "/home/rtos/.local/lib/python3.10/site-packages/torch/_dynamo/bytecode_transformation.py", line 1361 in transform_code_object
  File "/home/rtos/.local/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 750 in _compile_inner
  File "/home/rtos/.local/lib/python3.10/site-packages/torch/_utils_internal.py", line 95 in wrapper_function
  File "/home/rtos/.local/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 715 in compile_inner
  File "/home/rtos/.local/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 986 in _compile
  File "/home/rtos/.local/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 547 in __call__
  File "/home/rtos/.local/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 1380 in __call__
  File "/home/rtos/.local/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1750 in _call_impl
  File "/home/rtos/.local/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1739 in _wrapped_call_impl
  File "/home/rtos/.local/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 574 in _fn
  File "/home/rtos/.local/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1750 in _call_impl
  File "/home/rtos/.local/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1739 in _wrapped_call_impl
  File "/home/rtos/.local/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 1569 in inner
  File "/home/rtos/.local/lib/python3.10/site-packages/torch/export/_trace.py", line 662 in _export_to_torch_ir
  File "/home/rtos/.local/lib/python3.10/site-packages/torch/export/_trace.py", line 1283 in _strict_export_lower_to_aten_ir
  File "/home/rtos/.local/lib/python3.10/site-packages/torch/export/_trace.py", line 1834 in _export_for_training
  File "/home/rtos/.local/lib/python3.10/site-packages/torch/export/exported_program.py", line 128 in wrapper
  File "/home/rtos/.local/lib/python3.10/site-packages/torch/export/_trace.py", line 1008 in wrapper
  File "/home/rtos/.local/lib/python3.10/site-packages/torch/export/_trace.py", line 1970 in _export
  File "/home/rtos/.local/lib/python3.10/site-packages/torch/export/exported_program.py", line 128 in wrapper
  File "/home/rtos/.local/lib/python3.10/site-packages/torch/export/_trace.py", line 1008 in wrapper
  File "/home/rtos/.local/lib/python3.10/site-packages/torch/export/__init__.py", line 368 in export
  File "/home/rtos/.local/lib/python3.10/site-packages/ai_edge_torch/_convert/conversion.py", line 126 in export
  File "/home/rtos/.local/lib/python3.10/site-packages/ai_edge_torch/_convert/conversion.py", line 135 in <listcomp>
  File "/home/rtos/.local/lib/python3.10/site-packages/ai_edge_torch/_convert/conversion.py", line 134 in convert_signatures
  File "/home/rtos/.local/lib/python3.10/site-packages/ai_edge_torch/_convert/converter.py", line 172 in convert
  File "/home/rtos/.local/lib/python3.10/site-packages/ai_edge_torch/generative/utilities/converter.py", line 227 in _export_helper
  File "/home/rtos/.local/lib/python3.10/site-packages/ai_edge_torch/generative/utilities/converter.py", line 118 in convert_to_tflite
  File "/home/rtos/workspace/ghpark/ai-edge-torch/ai_edge_torch/generative/examples/llama/convert_to_tflite.py", line 84 in main
  File "/home/rtos/.local/lib/python3.10/site-packages/absl/app.py", line 254 in _run_main
  File "/home/rtos/.local/lib/python3.10/site-packages/absl/app.py", line 308 in run
  File "/home/rtos/workspace/ghpark/ai-edge-torch/ai_edge_torch/generative/examples/llama/convert_to_tflite.py", line 96 in <module>

Extension modules: numpy.core._multiarray_umath, numpy.core._multiarray_tests, numpy.linalg._umath_linalg, numpy.fft._pocketfft_internal, numpy.random._common, numpy.random.bit_generator, numpy.random._bounded_integers, numpy.random._mt19937, numpy.random.mtrand, numpy.random._philox, numpy.random._pcg64, numpy.random._sfc64, numpy.random._generator, google._upb._message, charset_normalizer.md, requests.packages.charset_normalizer.md, requests.packages.chardet.md, h5py._errors, h5py.defs, h5py._objects, h5py.h5, h5py.utils, h5py.h5t, h5py.h5s, h5py.h5ac, h5py.h5p, h5py.h5r, h5py._proxy, h5py._conv, h5py.h5z, h5py.h5a, h5py.h5d, h5py.h5ds, h5py.h5g, h5py.h5i, h5py.h5o, h5py.h5f, h5py.h5fd, h5py.h5pl, h5py.h5l, h5py._selector, scipy._lib._ccallback_c, scipy.sparse._sparsetools, _csparsetools, scipy.sparse._csparsetools, scipy.linalg._fblas, scipy.linalg._flapack, scipy.linalg.cython_lapack, scipy.linalg._cythonized_array_utils, scipy.linalg._solve_toeplitz, scipy.linalg._decomp_lu_cython, scipy.linalg._matfuncs_sqrtm_triu, scipy.linalg._matfuncs_expm, scipy.linalg._linalg_pythran, scipy.linalg.cython_blas, scipy.linalg._decomp_update, scipy.sparse.linalg._dsolve._superlu, scipy.sparse.linalg._eigen.arpack._arpack, scipy.sparse.linalg._propack._spropack, scipy.sparse.linalg._propack._dpropack, scipy.sparse.linalg._propack._cpropack, scipy.sparse.linalg._propack._zpropack, scipy.sparse.csgraph._tools, scipy.sparse.csgraph._shortest_path, scipy.sparse.csgraph._traversal, scipy.sparse.csgraph._min_spanning_tree, scipy.sparse.csgraph._flow, scipy.sparse.csgraph._matching, scipy.sparse.csgraph._reordering, jaxlib.cpu_feature_guard, PIL._imaging, psutil._psutil_linux, psutil._psutil_posix, pandas._libs.tslibs.ccalendar, pandas._libs.tslibs.np_datetime, pandas._libs.tslibs.dtypes, pandas._libs.tslibs.base, pandas._libs.tslibs.nattype, pandas._libs.tslibs.timezones, pandas._libs.tslibs.fields, pandas._libs.tslibs.timedeltas, pandas._libs.tslibs.tzconversion, pandas._libs.tslibs.timestamps, pandas._libs.properties, pandas._libs.tslibs.offsets, pandas._libs.tslibs.strptime, pandas._libs.tslibs.parsing, pandas._libs.tslibs.conversion, pandas._libs.tslibs.period, pandas._libs.tslibs.vectorized, pandas._libs.ops_dispatch, pandas._libs.missing, pandas._libs.hashtable, pandas._libs.algos, pandas._libs.interval, pandas._libs.lib, pandas._libs.ops, pandas._libs.hashing, pandas._libs.arrays, pandas._libs.tslib, pandas._libs.sparse, pandas._libs.internals, pandas._libs.indexing, pandas._libs.index, pandas._libs.writers, pandas._libs.join, pandas._libs.window.aggregations, pandas._libs.window.indexers, pandas._libs.reshape, pandas._libs.groupby, pandas._libs.json, pandas._libs.parsers, pandas._libs.testing, kiwisolver._cext, torch._C, torch._C._dynamo.autograd_compiler, torch._C._dynamo.eval_frame, torch._C._dynamo.guards, torch._C._dynamo.utils, torch._C._fft, torch._C._linalg, torch._C._nested, torch._C._nn, torch._C._sparse, torch._C._special (total: 125)
./convert-llama3.2-3b.sh: line 24: 63070 Segmentation fault      (core dumped) python3 ${SCRIPT_PATH}/convert_to_tflite.py --checkpoint_path /home/rtos/workspace/ghpark/models/${MODEL_NAME} --output_path ${OUTPUT_PATH}
[INFO] /home/rtos/workspace/ghpark/export/llama-3.2-3b-it-fp32  exported
